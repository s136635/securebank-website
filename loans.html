<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Calculator - SecureBank</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="images/logo.png" alt="Bank Logo" width="40" height="40" class="d-inline-block align-text-top me-2">
                SecureBank
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="about.html">About Us</a></li>
                    <li class="nav-item"><a class="nav-link" href="accounts.html">Accounts</a></li>
                    <li class="nav-item"><a class="nav-link" href="transfers.html">Transfers</a></li>
                    <li class="nav-item"><a class="nav-link active" href="loans.html">Loans</a></li>
                    <li class="nav-item"><a class="nav-link" href="support.html">Support</a></li>
                    <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
                    <li class="nav-item"><a class="nav-link" href="questionnaire.html">Feedback</a></li>
                    <li class="nav-item"><a class="nav-link" href="calculator.html">Calculator</a></li>
                    <li class="nav-item"><a class="nav-link" href="funpage.html">Fun & Games</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container my-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h1 class="h3 mb-0"><i class="bi bi-calculator me-2"></i>Loan Calculator</h1>
                        <p class="mb-0 mt-2">Calculate your monthly payments and total loan cost</p>
                    </div>
                    <div class="card-body p-4">
                        <div class="row">
                            <!-- Calculator Form -->
                            <div class="col-md-6">
                                <form id="loanCalculatorForm">
                                    <!-- Loan Amount -->
                                    <div class="mb-4">
                                        <label for="loanAmount" class="form-label">Loan Amount (OMR) *</label>
                                        <div class="input-group">
                                            <span class="input-group-text">OMR</span>
                                            <input type="number" class="form-control" id="loanAmount" 
                                                   placeholder="Enter loan amount" min="100" max="1000000" 
                                                   step="100" value="10000" required>
                                        </div>
                                        <div class="form-text">Minimum: OMR 100, Maximum: OMR 1,000,000</div>
                                    </div>

                                    <!-- Interest Rate -->
                                    <div class="mb-4">
                                        <label for="interestRate" class="form-label">Annual Interest Rate (%) *</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="interestRate" 
                                                   placeholder="Enter interest rate" min="0.1" max="25" 
                                                   step="0.1" value="5.5" required>
                                            <span class="input-group-text">%</span>
                                        </div>
                                        <div class="form-text">Range: 0.1% to 25%</div>
                                    </div>

                                    <!-- Loan Term -->
                                    <div class="mb-4">
                                        <label for="loanTerm" class="form-label">Loan Term *</label>
                                        <div class="row g-2">
                                            <div class="col-8">
                                                <input type="number" class="form-control" id="loanTerm" 
                                                       placeholder="Enter loan term" min="1" max="30" 
                                                       value="5" required>
                                            </div>
                                            <div class="col-4">
                                                <select class="form-select" id="termType">
                                                    <option value="years">Years</option>
                                                    <option value="months">Months</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-text">Maximum: 30 years or 360 months</div>
                                    </div>

                                    <!-- Loan Type -->
                                    <div class="mb-4">
                                        <label class="form-label">Loan Type</label>
                                        <div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="loanType" 
                                                       id="personalLoan" value="personal" checked>
                                                <label class="form-check-label" for="personalLoan">Personal</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="loanType" 
                                                       id="mortgageLoan" value="mortgage">
                                                <label class="form-check-label" for="mortgageLoan">Mortgage</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="loanType" 
                                                       id="autoLoan" value="auto">
                                                <label class="form-check-label" for="autoLoan">Auto</label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Calculate Button -->
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <i class="bi bi-calculator me-2"></i>Calculate Loan
                                        </button>
                                        <button type="reset" class="btn btn-outline-secondary">
                                            <i class="bi bi-arrow-clockwise me-2"></i>Reset
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Results Section -->
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-header bg-light">
                                        <h3 class="h5 mb-0">Calculation Results</h3>
                                    </div>
                                    <div class="card-body">
                                        <div id="resultsContainer" class="text-center py-4">
                                            <div class="text-muted">
                                                <i class="bi bi-calculator display-4"></i>
                                                <p class="mt-3">Enter loan details and click calculate to see results</p>
                                            </div>
                                        </div>
                                        
                                        <!-- Results will be dynamically inserted here -->
                                        <div id="calculationResults" style="display: none;">
                                            <!-- Monthly Payment -->
                                            <div class="mb-3 p-3 bg-primary bg-opacity-10 rounded">
                                                <div class="row align-items-center">
                                                    <div class="col-8">
                                                        <h6 class="mb-1">Monthly Payment</h6>
                                                        <small class="text-muted">Your fixed monthly payment</small>
                                                    </div>
                                                    <div class="col-4 text-end">
                                                        <span class="h5 text-primary fw-bold" id="monthlyPayment">0.00</span>
                                                        <small class="d-block text-muted">OMR</small>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Total Payment -->
                                            <div class="mb-3 p-3 bg-success bg-opacity-10 rounded">
                                                <div class="row align-items-center">
                                                    <div class="col-8">
                                                        <h6 class="mb-1">Total Payment</h6>
                                                        <small class="text-muted">Total amount you'll pay</small>
                                                    </div>
                                                    <div class="col-4 text-end">
                                                        <span class="h5 text-success fw-bold" id="totalPayment">0.00</span>
                                                        <small class="d-block text-muted">OMR</small>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Total Interest -->
                                            <div class="mb-3 p-3 bg-warning bg-opacity-10 rounded">
                                                <div class="row align-items-center">
                                                    <div class="col-8">
                                                        <h6 class="mb-1">Total Interest</h6>
                                                        <small class="text-muted">Total interest paid</small>
                                                    </div>
                                                    <div class="col-4 text-end">
                                                        <span class="h5 text-warning fw-bold" id="totalInterest">0.00</span>
                                                        <small class="d-block text-muted">OMR</small>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Loan Summary -->
                                            <div class="mt-4">
                                                <h6 class="border-bottom pb-2">Loan Summary</h6>
                                                <div class="row small">
                                                    <div class="col-6">
                                                        <div class="mb-2">
                                                            <strong>Loan Amount:</strong>
                                                            <div id="summaryLoanAmount" class="text-muted">0.00 OMR</div>
                                                        </div>
                                                        <div class="mb-2">
                                                            <strong>Interest Rate:</strong>
                                                            <div id="summaryInterestRate" class="text-muted">0%</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <div class="mb-2">
                                                            <strong>Loan Term:</strong>
                                                            <div id="summaryLoanTerm" class="text-muted">0 months</div>
                                                        </div>
                                                        <div class="mb-2">
                                                            <strong>Loan Type:</strong>
                                                            <div id="summaryLoanType" class="text-muted">Personal</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Amortization Schedule Button -->
                                            <div class="mt-4">
                                                <button type="button" class="btn btn-outline-primary w-100" 
                                                        id="showScheduleBtn" data-bs-toggle="modal" 
                                                        data-bs-target="#amortizationModal">
                                                    <i class="bi bi-table me-2"></i>View Amortization Schedule
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Loan Comparison Section -->
                        <div class="row mt-5">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header bg-info text-white">
                                        <h3 class="h5 mb-0"><i class="bi bi-graph-up me-2"></i>Loan Comparison</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="comparisonTable">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>Loan Type</th>
                                                        <th>Amount (OMR)</th>
                                                        <th>Interest Rate</th>
                                                        <th>Term</th>
                                                        <th>Monthly Payment</th>
                                                        <th>Total Interest</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="comparisonTableBody">
                                                    <!-- Comparison rows will be added here -->
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="mt-3">
                                            <button type="button" class="btn btn-info" id="addToComparison">
                                                <i class="bi bi-plus-circle me-2"></i>Add Current Loan to Comparison
                                            </button>
                                            <button type="button" class="btn btn-outline-secondary" id="clearComparison">
                                                <i class="bi bi-trash me-2"></i>Clear Comparison
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Amortization Schedule Modal -->
    <div class="modal fade" id="amortizationModal" tabindex="-1" aria-labelledby="amortizationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="amortizationModalLabel">Amortization Schedule</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered">
                            <thead class="table-primary">
                                <tr>
                                    <th>Payment #</th>
                                    <th>Payment Date</th>
                                    <th>Payment Amount</th>
                                    <th>Principal</th>
                                    <th>Interest</th>
                                    <th>Remaining Balance</th>
                                </tr>
                            </thead>
                            <tbody id="amortizationTableBody">
                                <!-- Amortization rows will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="printSchedule">
                        <i class="bi bi-printer me-2"></i>Print Schedule
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p>&copy; 2025 SecureBank. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <a href="#" class="text-white text-decoration-none me-3">Privacy Policy</a>
                    <a href="#" class="text-white text-decoration-none">Terms of Service</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        /**
         * LOAN CALCULATOR SYSTEM
         * This script implements a comprehensive loan calculator with advanced features
         */

        // =============================================
        // LOAN CALCULATION FUNCTIONS
        // =============================================

        /**
         * Calculates monthly payment using the standard loan formula
         * @param {number} principal - Loan amount
         * @param {number} annualRate - Annual interest rate (as percentage)
         * @param {number} years - Loan term in years
         * @returns {number} Monthly payment amount
         */
        function calculateMonthlyPayment(principal, annualRate, years) {
            // Convert annual rate to monthly and percentage to decimal
            const monthlyRate = (annualRate / 100) / 12;
            const numberOfPayments = years * 12;
            
            // Handle zero interest rate case
            if (monthlyRate === 0) {
                return principal / numberOfPayments;
            }
            
            // Standard loan payment formula
            const monthlyPayment = principal * 
                (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / 
                (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
            
            return monthlyPayment;
        }

        /**
         * Calculates loan details including total payment and interest
         * @param {number} principal - Loan amount
         * @param {number} annualRate - Annual interest rate
         * @param {number} years - Loan term in years
         * @returns {Object} Object containing loan calculation results
         */
        function calculateLoanDetails(principal, annualRate, years) {
            const monthlyPayment = calculateMonthlyPayment(principal, annualRate, years);
            const totalPayment = monthlyPayment * years * 12;
            const totalInterest = totalPayment - principal;
            
            return {
                monthlyPayment: monthlyPayment,
                totalPayment: totalPayment,
                totalInterest: totalInterest,
                numberOfPayments: years * 12
            };
        }

        /**
         * Generates amortization schedule for the loan
         * @param {number} principal - Loan amount
         * @param {number} annualRate - Annual interest rate
         * @param {number} years - Loan term in years
         * @returns {Array} Array of payment objects
         */
        function generateAmortizationSchedule(principal, annualRate, years) {
            const monthlyRate = (annualRate / 100) / 12;
            const numberOfPayments = years * 12;
            const monthlyPayment = calculateMonthlyPayment(principal, annualRate, years);
            
            let balance = principal;
            const schedule = [];
            const startDate = new Date();
            
            for (let i = 1; i <= numberOfPayments; i++) {
                const interestPayment = balance * monthlyRate;
                const principalPayment = monthlyPayment - interestPayment;
                balance -= principalPayment;
                
                // Calculate payment date
                const paymentDate = new Date(startDate);
                paymentDate.setMonth(paymentDate.getMonth() + i);
                
                schedule.push({
                    paymentNumber: i,
                    paymentDate: paymentDate.toLocaleDateString(),
                    paymentAmount: monthlyPayment,
                    principal: principalPayment,
                    interest: interestPayment,
                    remainingBalance: Math.max(0, balance) // Prevent negative balance
                });
                
                // Stop if balance is paid off
                if (balance <= 0) break;
            }
            
            return schedule;
        }

        // =============================================
        // DISPLAY FUNCTIONS
        // =============================================

        /**
         * Displays loan calculation results
         * @param {Object} results - Loan calculation results
         * @param {Object} inputs - Original input values
         */
        function displayResults(results, inputs) {
            // Show results container
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('calculationResults').style.display = 'block';
            
            // Format currency values
            const formatCurrency = (amount) => {
                return amount.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            };
            
            // Update results
            document.getElementById('monthlyPayment').textContent = formatCurrency(results.monthlyPayment);
            document.getElementById('totalPayment').textContent = formatCurrency(results.totalPayment);
            document.getElementById('totalInterest').textContent = formatCurrency(results.totalInterest);
            
            // Update summary
            document.getElementById('summaryLoanAmount').textContent = formatCurrency(inputs.principal) + ' OMR';
            document.getElementById('summaryInterestRate').textContent = inputs.annualRate + '%';
            document.getElementById('summaryLoanTerm').textContent = inputs.years * 12 + ' months (' + inputs.years + ' years)';
            document.getElementById('summaryLoanType').textContent = inputs.loanType.charAt(0).toUpperCase() + inputs.loanType.slice(1);
        }

        /**
         * Displays amortization schedule in modal
         * @param {Array} schedule - Amortization schedule array
         */
        function displayAmortizationSchedule(schedule) {
            const tableBody = document.getElementById('amortizationTableBody');
            tableBody.innerHTML = '';
            
            const formatCurrency = (amount) => {
                return amount.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            };
            
            schedule.forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${payment.paymentNumber}</td>
                    <td>${payment.paymentDate}</td>
                    <td>${formatCurrency(payment.paymentAmount)} OMR</td>
                    <td>${formatCurrency(payment.principal)} OMR</td>
                    <td>${formatCurrency(payment.interest)} OMR</td>
                    <td>${formatCurrency(payment.remainingBalance)} OMR</td>
                `;
                tableBody.appendChild(row);
            });
        }

        /**
         * Adds current loan to comparison table
         * @param {Object} results - Loan calculation results
         * @param {Object} inputs - Original input values
         */
        function addToComparisonTable(results, inputs) {
            const tableBody = document.getElementById('comparisonTableBody');
            const row = document.createElement('tr');
            
            const formatCurrency = (amount) => {
                return amount.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            };
            
            row.innerHTML = `
                <td>${inputs.loanType.charAt(0).toUpperCase() + inputs.loanType.slice(1)}</td>
                <td>${formatCurrency(inputs.principal)}</td>
                <td>${inputs.annualRate}%</td>
                <td>${inputs.years} years</td>
                <td>${formatCurrency(results.monthlyPayment)} OMR</td>
                <td>${formatCurrency(results.totalInterest)} OMR</td>
                <td>
                    <button type="button" class="btn btn-sm btn-outline-danger remove-comparison">
                        <i class="bi bi-trash"></i>
                    </button>
                </td>
            `;
            
            tableBody.appendChild(row);
            
            // Add event listener to remove button
            row.querySelector('.remove-comparison').addEventListener('click', function() {
                row.remove();
                updateComparisonTable();
            });
            
            updateComparisonTable();
        }

        /**
         * Updates comparison table state
         */
        function updateComparisonTable() {
            const tableBody = document.getElementById('comparisonTableBody');
            const rows = tableBody.querySelectorAll('tr');
            
            if (rows.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-muted py-3">
                            <i class="bi bi-info-circle me-2"></i>
                            No loans added to comparison. Calculate a loan and click "Add to Comparison".
                        </td>
                    </tr>
                `;
            }
        }

        // =============================================
        // EVENT HANDLERS AND INITIALIZATION
        // =============================================

        /**
         * Initializes event listeners when page loads
         */
        function initializeCalculator() {
            const calculatorForm = document.getElementById('loanCalculatorForm');
            const addToComparisonBtn = document.getElementById('addToComparison');
            const clearComparisonBtn = document.getElementById('clearComparison');
            const showScheduleBtn = document.getElementById('showScheduleBtn');
            const printScheduleBtn = document.getElementById('printSchedule');
            
            let currentResults = null;
            let currentInputs = null;
            
            // Form submission handler
            calculatorForm.addEventListener('submit', function(event) {
                event.preventDefault();
                
                // Get form values
                const principal = parseFloat(document.getElementById('loanAmount').value);
                const annualRate = parseFloat(document.getElementById('interestRate').value);
                let years = parseFloat(document.getElementById('loanTerm').value);
                const termType = document.getElementById('termType').value;
                const loanType = document.querySelector('input[name="loanType"]:checked').value;
                
                // Convert months to years if needed
                if (termType === 'months') {
                    years = years / 12;
                }
                
                // Validate inputs
                if (principal < 100 || principal > 1000000) {
                    alert('Loan amount must be between OMR 100 and OMR 1,000,000');
                    return;
                }
                
                if (annualRate < 0.1 || annualRate > 25) {
                    alert('Interest rate must be between 0.1% and 25%');
                    return;
                }
                
                if (years < 0.083 || years > 30) { // 1 month to 30 years
                    alert('Loan term must be between 1 month and 30 years');
                    return;
                }
                
                // Calculate loan details
                const results = calculateLoanDetails(principal, annualRate, years);
                currentResults = results;
                currentInputs = { principal, annualRate, years, loanType };
                
                // Display results
                displayResults(results, currentInputs);
                
                // Generate amortization schedule
                const schedule = generateAmortizationSchedule(principal, annualRate, years);
                displayAmortizationSchedule(schedule);
            });
            
            // Add to comparison handler
            addToComparisonBtn.addEventListener('click', function() {
                if (currentResults && currentInputs) {
                    addToComparisonTable(currentResults, currentInputs);
                } else {
                    alert('Please calculate a loan first before adding to comparison.');
                }
            });
            
            // Clear comparison handler
            clearComparisonBtn.addEventListener('click', function() {
                document.getElementById('comparisonTableBody').innerHTML = '';
                updateComparisonTable();
            });
            
            // Print schedule handler
            printScheduleBtn.addEventListener('click', function() {
                window.print();
            });
            
            // Form reset handler
            calculatorForm.addEventListener('reset', function() {
                document.getElementById('resultsContainer').style.display = 'block';
                document.getElementById('calculationResults').style.display = 'none';
                currentResults = null;
                currentInputs = null;
            });
            
            // Initialize comparison table
            updateComparisonTable();
        }

        // Initialize calculator when page loads
        document.addEventListener('DOMContentLoaded', initializeCalculator);
    </script>
</body>
</html>